{% extends "travel/baseIndex.html" %}

{% load humanize %}

{% block content %}
<div class="container py-5 text-center">
    <div class="mb-5 animate__animated animate__fadeIn">
        <div class="display-1 text-success mb-3">
            <i class="fa-solid fa-circle-check"></i>
        </div>
        <h1 class="fw-bold">Đặt tour thành công!</h1>
        
        <p class="lead text-muted">Mã đơn hàng: <strong class="text-primary">{{ booking.booking_code }}</strong></p>
        
        <p>Cảm ơn bạn, <strong>{{ booking.full_name }}</strong>. Chúng tôi đã nhận được yêu cầu đặt tour <strong>{{ booking.tour.name }}</strong>.</p>
        
        <div class="alert alert-light border d-inline-block px-4 py-3">
            <p class="mb-0 small text-muted">
                {% if booking.payment_status == 'paid' %}
                    <i class="fa-solid fa-envelope-circle-check me-2 text-success"></i>
                    Vé điện tử đã được gửi đến: <strong>{{ booking.email }}</strong>
                {% else %}
                    <i class="fa-solid fa-clock-rotate-left me-2 text-warning"></i>
                    Hệ thống đang xác nhận thanh toán. Vé sẽ được gửi đến <strong>{{ booking.email }}</strong> ngay khi hoàn tất.
                {% endif %}
            </p>
        </div>

        <div class="mt-4">
            <a href="{% url 'travel:home' %}" class="btn btn-outline-secondary px-4 rounded-pill">Về trang chủ</a>
            
            {% if booking.payment_status == 'unpaid' %}
                <a href="{% url 'travel:booking_payment' booking.id %}" class="btn btn-success px-4 shadow-sm rounded-pill">Thanh toán ngay</a>
            {% endif %}
            
            <a href="{% url 'travel:booking_history' %}" class="btn btn-primary px-4 shadow-sm rounded-pill">Lịch sử đặt tour</a>
        </div>
    </div>

    <hr class="my-5">

    <div class="text-start">
        <h3 class="fw-bold mb-4">
            <i class="fa-solid fa-wand-magic-sparkles text-primary me-2"></i>Vì bạn vừa đặt {{ booking.tour.name }}, bạn có thể thích:
        </h3>
        
        <div class="row g-4">
            {% for sim_tour in booking.tour.get_similar_tours %}
            <div class="col-md-3">
                <div class="card h-100 border-0 shadow-sm tour-card">
                    <div class="position-relative">
                        {% if sim_tour.image_main %}
                            <img src="{{ sim_tour.image_main.url }}" class="card-img-top" style="height: 180px; object-fit: cover; border-radius: 10px 10px 0 0;">
                        {% endif %}
                        <span class="position-absolute top-0 end-0 m-2 badge bg-warning text-dark shadow-sm">
                            {{ sim_tour.average_rating|floatformat:1 }} <i class="fa-solid fa-star"></i>
                        </span>
                    </div>
                    <div class="card-body">
                        <h6 class="fw-bold mb-1 text-truncate-2">{{ sim_tour.name }}</h6>
                        <p class="small text-muted mb-2">
                            <i class="fa-solid fa-location-dot me-1 text-danger"></i>{{ sim_tour.destination.name }}
                        </p>
                        <div class="d-flex justify-content-between align-items-center mt-auto">
                            <span class="text-danger fw-bold">{{ sim_tour.price|floatformat:0|intcomma }}đ</span>
                            <a href="{% url 'travel:tour_detail' sim_tour.slug %}" class="btn btn-sm btn-outline-success rounded-pill px-3">Chi tiết</a>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <p class="text-muted italic">Đang tìm kiếm thêm các tour hấp dẫn khác cho bạn...</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
    .text-truncate-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        height: 2.8em;
        line-height: 1.4em;
    }
    .tour-card { 
        transition: all 0.3s ease; 
        border-radius: 10px;
    }
    .tour-card:hover { 
        transform: translateY(-8px);
        shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
    }
    .animate__fadeIn {
        animation: fadeIn 1s;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
{% endblock %}